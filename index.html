<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<title>rCount Dashboard</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 50px;
  }
  button {
    padding: 10px 20px;
    font-size: 1.2rem;
    cursor: pointer;
  }
  #status {
    margin-top: 20px;
    font-size: 1rem;
    color: green;
  }
</style>
</head>
<body>
<h1>rCount Dashboard</h1>
<button id="btnAdd">Add visit</button>
<div id="status"></div>

<script>
const API_BASE = "https://rcount.onrender.com";

// Service Worker registreren
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(() => console.log("SW geregistreerd"))
    .catch(e => console.error("SW registratie mislukt:", e));
}

// Functie om request te versturen via beacon en SW
function addVisit() {
  const url = API_BASE + '/add';
  const payload = JSON.stringify({ time: Date.now() });

  // Beacon sturen
  if (navigator.sendBeacon) {
    const blob = new Blob([payload], { type: 'text/plain' }); // text/plain voorkomt preflight
    const sent = navigator.sendBeacon(url, blob);
    if (sent) {
      document.getElementById('status').textContent = "Beacon succesvol verzonden!";
      return;
    }
  }

  // Fallback naar SW retry
  if (navigator.serviceWorker.controller) {
    navigator.serviceWorker.controller.postMessage({
      type: 'storeFailed',
      request: { url, body: payload }
    });
    document.getElementById('status').textContent = "Verzoek opgeslagen voor retry via SW";
  } else {
    document.getElementById('status').textContent = "Geen SW actief, probeer opnieuw!";
  }
}

document.getElementById('btnAdd').addEventListener('click', addVisit);
</script>
</body>
</html>
