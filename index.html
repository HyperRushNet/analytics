<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<title>rCount Dashboard</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #0f1724; color: #e6eef8; }
button { padding: 10px 15px; font-size: 16px; cursor: pointer; margin-right: 10px; border-radius: 6px; border: none; background: #60a5fa; color: #04263b; }
.status { margin-top: 10px; font-size: 14px; }
</style>
</head>
<body>
<h1>rCount Visitor Tracker</h1>
<button id="btnAdd">Add visit</button>
<div class="status" id="status">Status: ready</div>

<script>
const API_BASE = "https://rcount.onrender.com";
const statusEl = document.getElementById('status');

// Service Worker registreren
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/analytics/sw.js')
    .then(() => console.log('SW registered'));
}

// Functie om visit toe te voegen
function addVisit() {
  const url = API_BASE + '/add';
  const payload = JSON.stringify({ time: Date.now() });

  // 1️⃣ Beacon proberen
  if (navigator.sendBeacon) {
    const blob = new Blob([payload], { type: 'application/json' });
    const sent = navigator.sendBeacon(url, blob);
    if (sent) {
      statusEl.textContent = 'Visit sent via beacon ✅';
      return;
    }
  }

  // 2️⃣ SW fallback
  if (navigator.serviceWorker.controller) {
    navigator.serviceWorker.controller.postMessage({
      type: 'storeFailed',
      request: { url, body: payload }
    });
    statusEl.textContent = 'No network, visit stored offline ⚡';
  } else {
    statusEl.textContent = 'SW not available, could not store visit ❌';
  }
}

document.getElementById('btnAdd').addEventListener('click', addVisit);
</script>
</body>
</html>
